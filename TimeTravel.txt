{$CLEO .s}                   
{$INCLUDE Common/CleoConstants.txt}
{$INCLUDE Time/Include/Variables.txt}
0000:
const
    KEY_HOVERCONVERSION = 67 // C
    KEY_DEBUG = 190 // "."
end
thread 'TIME'
gosub @Init
cleo_call @Setup 6 vehicle vehicle_flags dest_date dest_time past_date past_time

while true
    wait 10
    if
        Car.Wrecked(vehicle)
    then
        Car.RemoveReferences(vehicle)
        terminate_this_custom_script
    end 
    // Backend stuff
    cleo_call @MemoryHandling 6 vehicle vehicle_flags dest_date dest_time past_date past_time ret vehicle_flags dest_date dest_time
    cleo_call @DebugVariation 2 vehicle vehicle_flags ret vehicle_flags
    cleo_call @ResetVariation 2 vehicle vehicle_flags
    cleo_call @ResetCamera 2 vehicle vehicle_flags  
    
    // Animations
    cleo_call @FluxCapacitorAnimation 3 vehicle vehicle_flags timera ret timera 
    cleo_call @FlashTimeCircuits 2 vehicle vehicle_flags
    
    // Delorean stuff
    cleo_call @Fuel 2 vehicle vehicle_flags ret vehicle_flags
    cleo_call @Hook 2 vehicle vehicle_flags ret vehicle_flags
    cleo_call @HoverConversion 2 vehicle vehicle_flags ret vehicle_flags
    cleo_call @Fly 2 vehicle vehicle_flags
    
    /*// Check for any Time Travelling
    cleo_call @CheckPastTravel 1 vehicle ret result
    if 
        result == true
    then
        // TODO: Fix multiple time machines
        terminate_this_custom_script
        continue
    end 
    
    // Struck by lightning?
    cleo_call @CheckLightning 2 vehicle vehicle_flags ret result
    // Lightning check
    if
        result == true
    then
        // TODO: Time Travel with Lightning
        continue
    end   
    
    // Clocktower Run
    /*cleo_call @CheckWire 2 vehicle vehicle_flags ret result
    if 
        result == true
    then
        jump @Time88
    end*/
    
    // Time Travel Effects
    cleo_call @CheckSpeed 2 vehicle vehicle_flags ret result                                                                                           
    if 
        result == false
    then
        continue
    end  
    
    /*// Time Travel
    0AB4: past_date = var CDATE
    0AB4: past_time = var CTIME 
    if
        00DD:   player $PLAYER_ACTOR driving vehicle
    then
        0AB3: var TRAVEL = 1
        0581: toggle_radar 0
        gosub @GlobalDateToLocal
        0AB3: var PDATE = past_date
        0AB3: var PTIME = past_time
    end 
    cleo_call @Travel 2 vehicle vehicle_flags ret vehicle_flags
    0AB4: entry_date = var CDATE
    0AB4: entry_time = var CTIME      */
end


// Include all the helper threads here
{$INCLUDE Common/DrawTexture.txt}
{$INCLUDE Time/Include/Camera.txt}
//{$INCLUDE Time/Include/Change.txt}
{$INCLUDE Time/Include/Coils.txt}
{$INCLUDE Time/Include/Debug.txt}
{$INCLUDE Time/Include/Effects.txt}
{$INCLUDE Time/Include/Explosion.txt}
{$INCLUDE Time/Include/FluxCapacitor.txt}
{$INCLUDE Time/Include/Fuel.txt}
{$INCLUDE Time/Include/Hook.txt}
{$INCLUDE Time/Include/Hover.txt}
{$INCLUDE Time/Include/Init.txt}
{$INCLUDE Time/Include/Memory.txt}
//{$INCLUDE Time/Include/Past.txt}
{$INCLUDE Time/Include/Plasma.txt}
//{$INCLUDE Time/Include/Plate.txt}
//{$INCLUDE Time/Include/SetTime.txt}
//{$INCLUDE Time/Include/Slice.txt}
{$INCLUDE Time/Include/Sound.txt}
{$INCLUDE Time/Include/SpeedOffset.txt}
{$INCLUDE Time/Include/TimeCircuits.txt}
//{$INCLUDE Time/Include/TimeTravel.txt}
{$INCLUDE Time/Include/Wormhole.txt}
